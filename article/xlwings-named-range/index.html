<!DOCTYPE html>
<html lang="vi">

<head>
   <title> Sử dụng xlwings tương tác với MS Excel  - The PyMiers</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="robots" content="" />
  <link rel="stylesheet" type="text/css" href="/theme/css/app.css">
<link rel="stylesheet" type="text/css" href="http://pp.pymi.vn/theme/css/pygment.css">
  <!--
  <link href="https://fonts.googleapis.com/css?family=Fira+Sans" rel="stylesheet">
  -->

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">    <meta name="author" content="Pymiers" />
  <meta name="description" content="" />    <link href="http://pp.pymi.vn/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="The PyMiers Full Atom Feed" />         
  <meta name="tags" content="python" />
  <meta name="tags" content="xlwings" />
  <meta name="tags" content="excel" />
  <meta name="tags" content="vba" />
</head>

<body>
  <main class="wrapper">
    <section class="container">
      <header class='column'>
        <h1 class='title'><a href="http://pp.pymi.vn/">The PyMiers</a></h1>
      </header>

      <div class="section">
        <div class="row navbar">
          <div class="column nav-item is-active"><a href="http://pp.pymi.vn/category/trang-chu/">Trang chủ</a></div>
           <div class="column nav-item "><a href="http://pp.pymi.vn/pages/about/">About</a></div>
          <div class="column nav-item "><a href="http://pp.pymi.vn/pages/add/">Tạo bài viết</a></div>
          <div class="column nav-item "><a href="http://pp.pymi.vn/pages/rss/">RSS</a></div>
          <div class="column nav-item"><a href="/archives">Archives</a></div>
        </div>
      </div>
    </section>

<section class="container">
  <header>
    <h2 class="entry-title">
      <a href="http://pp.pymi.vn/article/xlwings-named-range/" rel="bookmark"
         title="Permalink to Sử dụng xlwings tương tác với MS Excel">Sử dụng xlwings tương tác với MS Excel</a></h2>  
  </header>
  <footer class='center'>
    <time class="published" datetime="2019-12-08T00:00:00+07:00"> 08/12/2019 </time>
    <address class="vcard author">By
                    <a class="url fn" href="http://pp.pymi.vn/author/htlcnn/">htlcnn</a>
 in <a href="http://pp.pymi.vn/category/trang-chu/">Trang chủ</a>
                </address>     <em>Tags</em>:     <a href="http://pp.pymi.vn/tag/python/"><em>python</em></a>,     <a href="http://pp.pymi.vn/tag/xlwings/"><em>xlwings</em></a>,     <a href="http://pp.pymi.vn/tag/excel/"><em>excel</em></a>,     <a href="http://pp.pymi.vn/tag/vba/"><em>vba</em></a>    </footer>
  <br>
  <div class="entry-content">
    <p><a href="https://github.com/xlwings/xlwings">xlwings</a> là 1 thư viện Python dùng để tương tác giữa Python và MS Excel. Hoạt động được trên Windows và Mac. xlwings có các tính năng:</p>
<ul>
<li><strong>Scripting</strong>: Tự động hóa/tương tác với Excel từ môi trường Python, sử dụng cú pháp gần với VBA mà vẫn "Pythonic".</li>
<li><strong>Macros</strong>: Viết các script python thay thế cho VBA macros, giúp code dễ đọc hơn. Sau khi viết script python xong, chỉ cần gọi 1 hàm trong VBA là script chạy.</li>
<li><strong>UDFs</strong>: Viết hàm người dùng tự định nghĩa bằng ngôn ngữ Python và sử dụng được hàm đó trong excel (Windows only).</li>
<li><strong>REST API</strong>: cung cấp REST API cho Excel workbook.</li>
</ul>
<h2>Cài đặt:</h2>
<div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">xlwings</span>
</pre></div>


<h2>Sử dụng:</h2>
<ol>
<li>Một số thao tác cơ bản:</li>
</ol>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xlwings</span> <span class="kn">as</span> <span class="nn">xw</span>

<span class="c1"># mở workbook mới</span>
<span class="n">new_wb</span> <span class="o">=</span> <span class="n">xw</span><span class="o">.</span><span class="n">Book</span><span class="p">()</span>
<span class="c1"># hoặc</span>
<span class="n">opening_wb</span> <span class="o">=</span> <span class="n">xw</span><span class="o">.</span><span class="n">Book</span><span class="p">(</span><span class="s1">&#39;name_of_opening_workbook&#39;</span><span class="p">)</span>
<span class="c1"># hoặc</span>
<span class="n">open_new_workbook</span> <span class="o">=</span> <span class="n">xw</span><span class="o">.</span><span class="n">Book</span><span class="p">(</span><span class="s1">&#39;full/relaive_path_to_xls&#39;</span><span class="p">)</span>

<span class="c1"># Lấy các sheets có trong file excel </span>
<span class="n">xw</span><span class="o">.</span><span class="n">sheets</span>

<span class="c1"># Làm việc với dữ liệu trong 1 sheet</span>
<span class="n">sht</span> <span class="o">=</span> <span class="n">xw</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;A1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;A1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;xxx&#39;</span>

<span class="c1"># tự động tìm bảng</span>
<span class="c1"># https://docs.xlwings.org/en/stable/datastructures.html#range-expanding</span>
<span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;A1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>
<span class="c1"># ...</span>
</pre></div>


<p><strong>Ngoài ra, <a href="https://docs.xlwings.org/en/stable/datastructures.html#pandas-dataframes">xlwings còn tích hợp pandas</a>.</strong></p>
<ol>
<li>Xử lý trường hợp cụ thể:
Trong video <a href="https://www.youtube.com/watch?v=wm7RNejVh8E">này</a>, xlwings được dùng để tự động tạo các named range cho hàng loạt file có cấu trúc tương tự. Mục đích là để làm bước tiếp theo: link giá trị từ nhiều file vào 1 file tổng hợp, dựa vào named range trong từng file chi tiết. Tham khảo <a href="https://gist.github.com/htlcnn/0ddd4e0023e0b623bc0e6006a9f9520c">script</a>.</li>
</ol>
<p>Trong script này còn sử dụng Excel VBA API: <a href="https://docs.microsoft.com/en-us/office/vba/api/excel.names.add">WorkBook.Names.Add</a> (tra cứu toàn bộ ở <a href="https://docs.microsoft.com/en-us/office/vba/api/overview/excel/object-model">đây</a>, được cung cấp qua <code>xw_object.api</code>). Tức là những gì không được cung cấp sẵn cú pháp Pythonic, ta sẽ sử dụng VBA API.</p>
<p>Hạn chế: range expand chỉ ứng dụng được cho vùng dữ liệu liên tục. Với "bảng" có các dòng/cột trống (để "format" cho đẹp) thì sẽ bị ngắt tại chỗ có dòng/cột trống. Vì vậy, thường sẽ phải chọn 1 range khá lớn/1 magic number để lấy được toàn bộ vùng dữ liệu cần xử lý.</p>
<p>Mọi việc phải xử lý trong video demo sẽ đơn giản hơn nếu có 1 file excel mẫu ban đầu, được định nghĩa sẵn các named range, sau đó mới duplicate ra để điền dữ liệu vào. Tuy nhiên, thực tế không như thế, ta phải xử lý lỗi một cách nhanh nhất, cũng giống như khi tập chép phạt: <code>"Anh xin lỗi\n" * 100</code></p>
  </div>
  <!-- /.entry-content -->
</section>
<section class="container">
  <div class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'pymier';
      var disqus_identifier = 'article/xlwings-named-range/';
      var disqus_url = 'http://pp.pymi.vn/article/xlwings-named-range/';
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//pymier.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the comments.</noscript>
  </div>
</section>

    <section class="container footer">
      <footer>
        <address>
        Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
        which takes great advantage of <a href="http://python.org">Python</a>.
        </address>
        <address>
          Học lập trình Python tại <a href="https://pymi.vn/">Pymi.vn</a>
        </address>
      </footer>
    </section>
  </main>

<script type="text/javascript">
var images = document.getElementsByTagName("img");
var i;

for(i = 0; i < images.length; i++) {
  images[i].className += " centered";
}
</script>
</body>

</html>