<!DOCTYPE html>
<html lang="vi">

<head>
   <title> black - quên đi nỗi lo PEP8  - The PyMiers</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="robots" content="" />
  <link rel="stylesheet" type="text/css" href="/theme/css/app.css">
<link rel="stylesheet" type="text/css" href="http://pp.pymi.vn/theme/css/pygment.css">
  <!--
  <link href="https://fonts.googleapis.com/css?family=Fira+Sans" rel="stylesheet">
  -->

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">    <meta name="author" content="Pymiers" />
  <meta name="description" content="" />    <link href="http://pp.pymi.vn/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="The PyMiers Full Atom Feed" />         
  <meta name="tags" content="python" />
  <meta name="tags" content="black" />
  <meta name="tags" content="formatter" />
</head>

<body>
  <main class="wrapper">
    <section class="container">
      <header class='column'>
        <h1 class='title'><a href="http://pp.pymi.vn/">The PyMiers</a></h1>
      </header>

      <div class="section">
        <div class="row navbar">
          <div class="column nav-item is-active"><a href="http://pp.pymi.vn/category/trang-chu/">Trang chủ</a></div>
           <div class="column nav-item "><a href="http://pp.pymi.vn/pages/about/">About</a></div>
          <div class="column nav-item "><a href="http://pp.pymi.vn/pages/add/">Tạo bài viết</a></div>
          <div class="column nav-item "><a href="http://pp.pymi.vn/pages/rss/">RSS</a></div>
          <div class="column nav-item"><a href="/archives">Archives</a></div>
        </div>
      </div>
    </section>

<section class="container">
  <header>
    <h2 class="entry-title">
      <a href="http://pp.pymi.vn/article/black/" rel="bookmark"
         title="Permalink to black - quên đi nỗi lo PEP8">black - quên đi nỗi lo PEP8</a></h2>  
  </header>
  <footer class='center'>
    <time class="published" datetime="2020-03-15T00:00:00+07:00"> 15/03/2020 </time>
    <address class="vcard author">By
                    <a class="url fn" href="http://pp.pymi.vn/author/hvnsweeting/">hvnsweeting</a>
 in <a href="http://pp.pymi.vn/category/trang-chu/">Trang chủ</a>
                </address>     <em>Tags</em>:     <a href="http://pp.pymi.vn/tag/python/"><em>python</em></a>,     <a href="http://pp.pymi.vn/tag/black/"><em>black</em></a>,     <a href="http://pp.pymi.vn/tag/formatter/"><em>formatter</em></a>    </footer>
  <br>
  <div class="entry-content">
    <h2>Code Python phải chuẩn PEP8</h2>
<p>Ngay khi bạn mới làm quen với Python được vài tuần, mới biết tí for loop hay
function, PEP8 từ đâu đó sẽ hiện ra.
PEP8 là hướng dẫn viết code chuẩn Python, chứ không phải chuẩn C, Java, hay
không có chuẩn nào cả.
Nếu tự hoc code một mình, có khi giờ này bạn đã làm ra vài chục script, chạy
ầm ầm mà vẫn chưa 1 lần nghe PEP8. Tiêu chuẩn code là thứ chỉ hiện ra rõ ràng,
khi ta làm việc với người khác, chỉ sau vài function, sự mâu thuẫn về style
sẽ hiện ra ngay, và khi ông Chí Phèo không đồng ý với style của Bá Kiến, thì
cả 2 phải lên phường và thống nhất dùng chuẩn chung mà làng Vũ Đại đặt ra - hay
ở đây ta gọi là PEP8.</p>
<p>PEP8 có thể xem chi tiết tại <a href="https://www.python.org/dev/peps/pep-0008/">PEP0008</a>
hay <a href="https://pep8.org/">https://pep8.org/</a>,
tiêu chuẩn PEP8 được chấp nhận trên toàn trái đất, thậm chí <a href="https://medium.com/pymi/cia-d%C3%B9ng-python-r%E1%BA%A5t-nhi%E1%BB%81u-32144ecddd50">CIA</a>,
Google cũng
chỉ sửa đi chút xíu, bởi nó là chuẩn hay, chuẩn tốt.</p>
<h2>Chuyện đau đầu về xì tai (style)</h2>
<p>Style vốn là một thứ dễ gây ra tranh cãi. Tôi thích kiểu Việt Nam dịu dàng,
anh thích kiểu Pháp say đắm, ông kia thích kiểu Mỹ mạnh mẽ và hùng hục. Vậy
ai là người sai?
Cuộc tranh cãi về style viết code đã kéo dài suốt từ ngày lập trình xuất hiện,
tới giờ vẫn chưa kết thúc. Bởi đã là style, thì khó nói chuyện đúng sai.</p>
<p>Thế rồi mọi cuộc chơi vui, cũng phải đến hồi kết. Một ngôn ngữ lập trình đơn
giản xuất hiện với tên hai chữ <code>Go</code> (sau để tránh nhầm lẫn thì gọi là Golang),
và để tăng thêm sự đơn giản, nó đi kèm
sẵn một chương trình với tên <code>gofmt</code> (đọc là gâu phằm) - chương trình này sẽ
format tất cả code trong thư mục về một chuẩn mà nó đã quy định. Ban đầu,
người ta vẫn còn tranh cãi về việc bị ép style, nhưng rồi sau một hồi, lợi ích
của mỗi cái tôi đã sụp đổ trước lợi ích tập thể mà <code>gofmt</code> mang lại: mọi đoạn
code đều trông giống nhau, khiến style không còn gì để tranh cãi, lập trình viên
nhìn code của thằng kia cũng giống như của mình, dễ đọc - dễ hiểu hơn, expert
hay newbie đều chung 1 style cả.</p>
<p><code>gofmt</code> không phải là chương trình đầu tiên làm vậy, trước đây, trong cộng
đồng Python đã xuất hiện 1 chương trình tên <code>autopep8</code> hay Google cũng có
<a href="https://github.com/google/yapf">YAPF</a>. Nhưng <code>Go</code> là ngôn ngữ đầu tiên mang
code formatter vào chính thống, chính thức chấm dứt cuộc chiến vô bổ về style
kéo dài vài thập kỷ. Để rồi từ đó, các ngôn ngữ lập trình khác đua nhau học theo
như <a href="https://github.com/rust-lang/rustfmt">Rust</a>,
<a href="https://elixir-lang.org/blog/2018/01/17/elixir-v1-6-0-released/">Elixir</a>
và Python thì có <a href="https://github.com/psf/black">black</a>.</p>
<p>Không có giải pháp nào để giải quyết 1 vấn đề tốt hơn là làm cho nó biến mất.</p>
<h2>black là gì</h2>
<p>Black là một câu lệnh cài bằng pip: <code>pip install black</code>, yêu cầu Python3.6 trở
lên mới chạy. <code>black</code> xuất hiện như một project của một lập trình viên nào đó
trên in tơ nét, sau vài năm trở nên cực kỳ phổ biến, và giờ đã chính thức
được nằm dưới mái nhà PSF (Python Software Foundation) cùng với <code>requests</code>.</p>
<p><a href="https://github.com/psf/black/blob/master/black.py">https://github.com/psf/black/blob/master/black.py</a></p>
<p>Code của black chỉ vọn vẹn 4000 dòng, sử dụng các tính năng mới nhất của Python
như f-string, type annotation, asyncio...
(vì thế nên yêu cầu Python3.6+ để chạy, mặc dù vẫn có thể format code 2.7)</p>
<h2>Dùng black để format code Python</h2>
<p>Ví dụ có 1 file foo.py</p>
<div class="highlight"><pre><span></span><code><span class="nv">def</span> <span class="nv">sum_two</span><span class="ss">(</span><span class="nv">a</span>,<span class="nv">b</span><span class="ss">)</span>:
    <span class="nv">c</span><span class="o">=</span> <span class="nv">a</span>  <span class="o">+</span> <span class="nv">b</span>


    <span class="k">return</span> <span class="nv">c</span>
</code></pre></div>

<p>Nếu thành thạo PEP8, thấy ngay có 4 chỗ phải sửa ở đây:
<code>a,b</code> thiếu dấu space sau <code>,</code>, <code>c</code> thiếu dấu space theo sau, sau <code>a</code> thừa 1
space, thừa 1 dòng
trống trước return. Vậy chỉ 3 dòng code, người review phải gõ ra 4 "vấn đề"
về style, và người code ra 3 dòng này, khi đọc review cũng chẳng vui vẻ gì,
kể cả người ta nói đúng.</p>
<p>Chạy:</p>
<div class="highlight"><pre><span></span><code>$ black foo.py
reformatted foo.py
All <span class="k">done</span>! ✨ 🍰 ✨
<span class="m">1</span> file reformatted.

$ cat foo.py
def sum_two<span class="o">(</span>a, b<span class="o">)</span>:
    <span class="nv">c</span> <span class="o">=</span> a + b

    <span class="k">return</span> c
</code></pre></div>

<p>Đẹp, chuẩn, ngon! Không còn gì mong đợi thêm.
black có nhiều option để chỉnh style cho phù hợp với tiêu chuẩn của bạn,
hay dùng nhất là để set độ dài của 1 dòng, vốn là 79 ký tự theo chuẩn PEP8,
thì black mặc định là 88:</p>
<div class="highlight"><pre><span></span><code>  -l, --line-length INTEGER       How many characters per line to allow.
                                  <span class="o">[</span>default: <span class="m">88</span><span class="o">]</span>
</code></pre></div>

<p>Bạn có thể gọi <code>black -l79 .</code> để theo PEP8.</p>
<h2>Hành động của chúng ta</h2>
<p>Đã đến lúc để quên đi việc format code bằng tay, nhớ vài chục tiêu chuẩn
của PEP8, format code hãy để cho đen (black) không vâu lo - việc này để
đen không vâu lo.
Thêm dòng này vào <code>Makefile</code> của bạn:</p>
<div class="highlight"><pre><span></span><code><span class="n">fmt</span><span class="o">:</span>
    <span class="n">black</span> <span class="o">-</span><span class="n">l79</span> <span class="o">.</span>
</code></pre></div>

<p>hay cài đặt text editor/IDE tự động chạy <code>black</code> sau mỗi lần save code.</p>
<p>Thêm dòng sau vào CI để bắt quả tang thằng nào không dùng black:</p>
<div class="highlight"><pre><span></span><code>black --check .
</code></pre></div>

<p>Black sẽ thông báo các file chưa chuẩn format:</p>
<div class="highlight"><pre><span></span><code>$ black --check .
would reformat /home/hvn/me/people/content/mypy_simple.py
would reformat /home/hvn/me/people/publishconf.py
would reformat /home/hvn/me/people/pelicanconf.py
would reformat /home/hvn/me/people/fabfile.py
Oh no! 💥 💔 💥
<span class="m">4</span> files would be reformatted, <span class="m">1</span> file would be left unchanged.
</code></pre></div>

<h2>Kết luận</h2>
<p>Hãy dùng <code>black</code>! Và đừng quên share bài viết này, để cộng đồng code Python
không còn mất thời gian ít bổ.</p>
  </div>
  <!-- /.entry-content -->
</section>
<section class="container">
  <div class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'pymier';
      var disqus_identifier = 'article/black/';
      var disqus_url = 'http://pp.pymi.vn/article/black/';
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//pymier.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the comments.</noscript>
  </div>
</section>

    <section class="container footer">
      <footer>
        <address>
        Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
        which takes great advantage of <a href="http://python.org">Python</a>.
        </address>
        <address>
          Học lập trình Python tại <a href="https://pymi.vn/">Pymi.vn</a>
        </address>
      </footer>
    </section>
  </main>

<script type="text/javascript">
var images = document.getElementsByTagName("img");
var i;

for(i = 0; i < images.length; i++) {
  images[i].className += " centered";
}
</script>
</body>

</html>