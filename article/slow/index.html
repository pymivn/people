<!DOCTYPE html>
<html lang="vi">

<head>
   <title> Python l√™n sao k√™ ch·∫≠m - l√†m web ƒë∆∞·ª£c kh√¥ng?  - The PyMiers</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="robots" content="" />
  <link rel="stylesheet" type="text/css" href="/theme/css/app.css">
<link rel="stylesheet" type="text/css" href="http://pp.pymi.vn/theme/css/pygment.css">
  <!--
  <link href="https://fonts.googleapis.com/css?family=Fira+Sans" rel="stylesheet">
  -->

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">    <meta name="author" content="Pymiers" />
  <meta name="description" content="" />    <link href="http://pp.pymi.vn/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="The PyMiers Full Atom Feed" />         
  <meta name="tags" content="python" />
  <meta name="tags" content="performance" />
  <meta name="tags" content="benchmark" />
  <meta name="tags" content="webframework" />
</head>

<body>
  <main class="wrapper">
    <section class="container">
      <header class='column'>
        <h1 class='title'><a href="http://pp.pymi.vn/">The PyMiers</a></h1>
      </header>

      <div class="section">
        <div class="row navbar">
          <div class="column nav-item is-active"><a href="http://pp.pymi.vn/category/trang-chu/">Trang ch·ªß</a></div>
           <div class="column nav-item "><a href="http://pp.pymi.vn/pages/about/">About</a></div>
          <div class="column nav-item "><a href="http://pp.pymi.vn/pages/add/">T·∫°o b√†i vi·∫øt</a></div>
          <div class="column nav-item "><a href="http://pp.pymi.vn/pages/rss/">RSS</a></div>
          <div class="column nav-item"><a href="/archives">Archives</a></div>
        </div>
      </div>
    </section>

<section class="container">
  <header>
    <h2 class="entry-title">
      <a href="http://pp.pymi.vn/article/slow/" rel="bookmark"
         title="Permalink to Python l√™n sao k√™ ch·∫≠m - l√†m web ƒë∆∞·ª£c kh√¥ng?">Python l√™n sao k√™ ch·∫≠m - l√†m web ƒë∆∞·ª£c kh√¥ng?</a></h2>  
  </header>
  <footer class='center'>
    <time class="published" datetime="2021-09-11T00:00:00+07:00"> 11/09/2021 </time>
    <address class="vcard author">By
                    <a class="url fn" href="http://pp.pymi.vn/author/hvnsweeting/">hvnsweeting</a>
 in <a href="http://pp.pymi.vn/category/trang-chu/">Trang ch·ªß</a>
                </address>     <em>Tags</em>:     <a href="http://pp.pymi.vn/tag/python/"><em>python</em></a>,     <a href="http://pp.pymi.vn/tag/performance/"><em>performance</em></a>,     <a href="http://pp.pymi.vn/tag/benchmark/"><em>benchmark</em></a>,     <a href="http://pp.pymi.vn/tag/webframework/"><em>webframework</em></a>    </footer>
  <br>
  <div class="entry-content">
    <p><a href="https://pymi.vn">Pymi.vn</a> l√† m·ªôt ƒë∆°n v·ªã ƒë√†o t·∫°o Python th·ª±c chi·∫øn ·ªü Vi·ªát Nam,
h·ªçc xong ƒëi l√†m lu√¥n. Ch√∫ng t√¥i ƒë∆∞a th·∫≥ng v·∫•n ƒë·ªÅ v·ªõi h·ªçc vi√™n
m·ªôt s·ª± th·∫≠t v·ªÅ Python m√† kh√¥ng h·ªÅ gi·∫•u di·∫øm: Python <strong>ch·∫°y</strong> ch·∫≠m h∆°n (h·∫ßu h·∫øt) c√°c
ng√¥n ng·ªØ l·∫≠p tr√¨nh kh√°c. ƒêi·ªÅu n√†y ƒë∆∞·ª£c ƒë∆∞a v√†o b√†i h·ªçc v√† h·ªçc vi√™n ƒë∆∞·ª£c
t·ª± tay ƒëo xem m√°y c·ªßa m√¨nh t√≠nh ƒë∆∞·ª£c bao nhi√™u ph√©p +1 trong m·ªôt gi√¢y. Xem k·∫øt qu·∫£ t·∫°i: <a href="https://cpu.pymi.vn/">cpu.pymi.vn</a></p>
<p>K·∫øt qu·∫£ trung b√¨nh ·ªü kho·∫£ng 15-30 tri·ªáu ph√©p c·ªông / gi√¢y v·ªõi c√°c m√°y t√≠nh Intel i3 i5 i7.
ƒê·ªÉ l√†m m·ªëc so s√°nh, code C t∆∞∆°ng t·ª± c√≥ th·ªÉ t√≠nh kho·∫£ng 1 t·ª∑ ph√©p c·ªông / gi√¢y (30-70x).</p>
<p>ƒêa s·ªë ng∆∞·ªùi m·ªõi ƒëi h·ªçc Python ƒë·ªÅu kh√¥ng h·ªÅ bi·∫øt chuy·ªán n√†y, h·ªç ƒëi h·ªçc v√¨ s·ª± hot,
s·ª± ƒë∆°n gi·∫£n,
·ª©ng d·ª•ng kh·∫Øp n∆°i c·ªßa Python t·ª´ AI ML, DeepLearning, Blockchain, ...etc. ƒêi·ªÅu ·∫•y
cho th·∫•y m·ªôt ph·∫ßn quan tr·ªçng v·ªÅ t√≠nh ch·∫•t c·ªßa ng∆∞·ªùi d√πng: ch·ªçn ng√¥n ng·ªØ l·∫≠p tr√¨nh
kh√¥ng ph·∫£i v√¨ n√≥ CH·∫†Y nhanh, h·ªç kh√¥ng t√¨m h·ªçc C/C++ hay Fortran.</p>
<p>Trong ƒë√≥ m√¢u thu·∫´n h∆°n c·∫£, l√† ML/DeepLearning, lƒ©nh v·ª±c c·∫ßn t√≠nh to√°n c·ª±c nhi·ªÅu,
l·∫°i d√πng Python ph·ªï bi·∫øn nh·∫•t.
M√¢u thu·∫´n n√†y th∆∞·ªùng ƒë·ªÉ d√†nh h·ªèi ph·ªèng v·∫•n c√°c "data scientist" xem c√≥ hi·ªÉu t·∫°i
sao kh√¥ng? C√≤n v·ªõi b·∫°n ƒë·ªçc, ch√∫ng t√¥i ƒë·ªÉ d√†nh c√¢u tr·∫£ l·ªùi ·ªü cu·ªëi b√†i.</p>
<p><img alt="fast" src="https://images.unsplash.com/photo-1555980483-93e7b3529e1a?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;dl=kiril-dobrev-UB0QiVPsXgc-unsplash.jpg&amp;w=800"></p>
<p><center>Photo by <a href="https://unsplash.com/@kirildobrev?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Kiril Dobrev</a> on <a href="https://unsplash.com/s/photos/vietnam-hanoi?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a></center></p>
<p>ƒê·ªÉ so s√°nh t·ªëc ƒë·ªô, ng∆∞·ªùi d√πng th·ª±c hi·ªán c√°c "benchmark", gi·∫£i m·ªôt b√†i to√°n c·ª• th·ªÉ
v√† mang c√°c ph∆∞∆°ng √°n (ng√¥n ng·ªØ/framework) ra so.</p>
<p>Trang web
<a href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/">https://benchmarksgame-team.pages.debian.net/benchmarksgame/</a>
th·ª±c hi·ªán gi·∫£i c√°c b√†i to√°n/thu·∫≠t to√°n c·∫ßn t√≠nh to√°n nhi·ªÅu v√† ƒë∆∞a ra k·∫øt qu·∫£.
Python trong b·∫£ng so s√°nh n√†y, ch·ªâ nhanh h∆°n hai ng√¥n ng·ªØ ph·ªï bi·∫øn: Perl v√† Ruby.</p>
<p><img src="https://benchmarksgame-team.pages.debian.net/benchmarksgame/download/fastest-more.svg" width="800"></p>
<p><a href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/box-plot-summary-charts.html">Top 4 ƒë·∫ßu b·∫£ng: C++, C, Rust, Fortran</a>,
ch√∫ √Ω d√≤ng k·∫øt lu·∫≠n quan tr·ªçng tr√™n trang vi·∫øt:</p>
<blockquote>
<p>It's important to be realistic: most people don't care about program performance most of the time.</p>
</blockquote>
<h2>Python trong l√†m web</h2>
<h3>Tr√™n th·∫ø gi·ªõi</h3>
<p>Trang web vi·∫øt b·∫±ng Python c√≥ l∆∞·ª£ng ng∆∞·ªùi truy c·∫≠p l·ªõn nh·∫•t th·∫ø gi·ªõi hi·ªán nay
c√≥ l·∫Ω l√† Instagram.com - m·∫°ng x√£ h·ªôi h√¨nh ·∫£nh ban ƒë·∫ßu l√† 1 startup, sau ƒë√≥
ƒë√£ ƒë∆∞·ª£c Facebook mua l·∫°i.</p>
<p>T·∫°i th·ªùi ƒëi·ªÉm vi·∫øt b√†i, Instagram.com ƒë·ª©ng th·ª© 21 to√†n c·∫ßu v·ªÅ l∆∞·ª£t truy c·∫≠p
tr√™n b·∫£ng x·∫øp h·∫°ng c·ªßa <a href="https://alexa.com">Alexa</a>, sau Netflix.com, tr∆∞·ªõc Microsoft.com.
Instagram engineer blog v·ªÅ Python t·∫°i <a href="https://instagram-engineering.com/tagged/python">https://instagram-engineering.com/tagged/python</a>.</p>
<p>M·ªôt s·ªë v√≠ d·ª• kh√°c nh∆∞ <a href="https://eng.uber.com/building-tincup-microservice-implementation/">Uber core d√πng Python</a>,
<a href="https://dropbox.tech/tag-results.python">DropBox d√πng Python</a>,
hay <a href="https://opensource.googleblog.com/2017/01/grumpy-go-running-python.html">Youtube tr∆∞·ªõc khi Google mua l·∫°i d√πng Python</a>
ph·ª•c v·ª• h√†ng tri·ªáu request m·ªói gi√¢y.</p>
<blockquote>
<p>The front-end server that drives youtube.com and YouTube‚Äôs APIs is primarily
written in Python, and it serves millions of requests per second!</p>
</blockquote>
<h3>·ªû Vi·ªát Nam</h3>
<p>T·∫°i th·ªùi ƒëi·ªÉm vi·∫øt b√†i 2021-09-11, Vnexpress.net l√† trang web c·ªßa Vi·ªát Nam
ƒë·ª©ng th·ª© #4 VietNam v√† #396 to√†n c·∫ßu tr√™n <a href="https://www.alexa.com/topsites/countries/VN">Alexa.com</a>
3 trang top VN l√† Google, Youtube, Facebook. N·∫øu xem ti·∫øp top 50 Vi·ªát Nam,
c√°c t√™n h·∫ßu h·∫øt l√† c√°c trang b√°o m·∫°ng, hay th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠ l·ªõn nh∆∞ Shopee,
Lazada, Tiki.
C√°c trang n√†y vi·∫øt b·∫±ng c√¥ng ngh·ªá n√†o kh√¥ng r√µ, nh∆∞ng r√µ r√†ng l√† l∆∞·ª£t truy c·∫≠p
ƒë·ªÅu √≠t h∆°n Instagram ƒë√°ng k·ªÉ.</p>
<h3>C√°c ƒë∆°n v·ªã ƒëo t·ªëc ƒë·ªô trang web</h3>
<h4>Request per seconds (RPS) - throughput</h4>
<p>RPS - c√≥ n∆°i vi·∫øt l√† reqs/s, th∆∞·ªùng l√† ƒë∆°n v·ªã ch√≠nh d√πng ƒë·ªÉ ƒëo xem 1 trang web
c√≥ th·ªÉ ph·ª•c v·ª• ƒë∆∞·ª£c bao nhi√™u y√™u c·∫ßu m·ªói gi√¢y. RPS c√≤n c√≥ t√™n kh√°c l√† <a href="https://www.techempower.com/blog/2016/02/10/think-about-performance-before-building-a-web-application/">"throughput"</a>.
ƒê·ªÉ b·∫°n ƒë·ªçc h√¨nh dung ƒë∆∞·ª£c ƒë·ªô l·ªõn c·ªßa RPS t·∫°i c√°c website th·∫ø n√†o, sau ƒë√¢y l√† v√†i v√≠ d·ª•:</p>
<ul>
<li>NƒÉm 2020, ch∆∞∆°ng tr√¨nh Rap Vi·ªát ƒë·∫°t k·ª∑ l·ª•c c√≥ l∆∞·ª£ng ng∆∞·ªùi xem c√πng l√∫c <a href="https://tienphong.vn/thuc-hu-cau-chuyen-rap-viet-lap-ki-luc-nguoi-xem-cao-nhat-the-gioi-post1290225.tpo">cao
nh·∫•t t·∫°i Vi·ªát Nam v·ªõi con s·ªë
1.051.000</a>...
cho th·∫•y Youtube ch·∫°y ngon l√†nh th·∫ø n√†o.
ƒê√≥ l√† ƒë·ªânh cao t·∫°i Vi·ªát Nam, ƒë·∫•t n∆∞·ªõc ~ 100 tri·ªáu d√¢n, th√¨ max l√† 1% xem c√πng
m·ªôt l√∫c (kh√¥ng √≠t ng∆∞·ªùi ·ªü n∆∞·ªõc ngo√†i). ƒê·ª´ng t∆∞·ªüng t∆∞·ª£ng n∆∞·ªõc c√≥ 100 tri·ªáu d√¢n
th√¨ c√≥ c√°i g√¨ 50 tri·ªáu ng∆∞·ªùi c√πng l√†m m·ªôt l√∫c.</li>
<li>6/9/2021, <a href="https://tuoitre.vn/chu-tich-ubnd-tp-hcm-tra-loi-truc-tuyen-vung-xanh-duoc-di-cho-1-tuan-lan-mo-dan-mot-so-dich-vu-20210906184222848.htm">ch·ªß t·ªãch th√†nh ph·ªë HCM l√™n livestream gi·∫£i ƒë√°p th·∫Øc m·∫Øc c·ªßa ng∆∞·ªùi
d√¢n</a>
, c√≥ th·ªÉ ƒëo√°n h·∫ßu h·∫øt ch·ªâ c√≥ ng∆∞·ªùi d√¢n TPHCM m·ªõi xem, l∆∞·ª£ng view ch·ª•p trong ·∫£nh l√† 74k,
tr√™n t·ªïng <a href="https://tuoitre.vn/toc-do-tiem-vac-xin-o-tp-hcm-dan-tang-cao-da-co-hon-1-trieu-nguoi-tiem-mui-2-20210911085618942.htm">d√¢n s·ªë &gt;=18 tu·ªïi TPHCM c·ª° kho·∫£ng 7.2 tri·ªáu ng∆∞·ªùi</a> - t·∫°i th·ªùi ƒëi·ªÉm h·∫ßu h·∫øt
ng∆∞·ªùi d√¢n ƒë·ªÅu ·ªü nh√† gi√£n c√°ch x√£ h·ªôi theo ch·ªâ th·ªã 16, cho th·∫•y Facebook livestream ngon l√†nh th·∫ø n√†o.</li>
<li><a href="https://mangadex.dev/mangadex-v5-infrastructure-overview/">mangadex.org v·ªõi trung b√¨nh ~2000 rps</a> - #5,895 tr√™n Alexa.com.
soha.vn - 1 trang b√°o m·∫°ng kh√° l·ªõn c·ªßa VCCorp, #50 VN, x·∫øp #5,789 th·∫ø gi·ªõi - g·∫ßn v·ªõi mangadex.
Nhaccuatui.vn - trang nghe nh·∫°c l·ªõn nh√¨, ba t·∫°i Vi·ªát
Nam, ch·ªâ x·∫øp #14,770. V·∫≠y tr·ª´ khi b·∫°n l√†m t·∫°i c√°c c√¥ng ty c√≥ website ch·∫°y top
50 VN, b·∫°n m·ªõi c√≥ 2000 RPS.</li>
<li>2000 RPS =&gt; 2000 * 86400 = 172.800.000 requests/day. <strong>172 tri·ªáu l∆∞·ª£t truy c·∫≠p</strong>
m·ªói ng√†y. Trang web c·ªßa b·∫°n/ c√¥ng ty/ startup c·ªßa b·∫°n li·ªáu c√≥ ƒë∆∞·ª£c 86400 reqs/day? (1 RPS).
Vi·ªác c√≥ m·ªôt website v·ªõi trung b√¨nh 2000RPS - top 6000 th·∫ø gi·ªõi, kh√≥ h∆°n nhi·ªÅu nhi·ªÅu nhi·ªÅu
l·∫ßn so v·ªõi vi·ªác vi·∫øt code x·ª≠ l√Ω 2000 RPS.</li>
<li><a href="https://mark.mcnally.je/blog/post/My%20%C2%A34%20a%20month%20server%20can%20handle%204.2%20million%20requests%20a%20day">M·ªôt l·∫≠p tr√¨nh vi√™n ƒë√¢u ƒë√≥ ng·ªìi ƒëo</a> th·ª≠ v·ªõi 1 c√°i m√°y ·∫£o cloud 1CPU 2GB RAM ¬£4 (5.5 USD == 126.000VND).
c√≥ th·ªÉ ch·∫°y web Django v·ªõi 54.3 RPS (54 * 86400 == 4.665.600 reqs/day),
th√™m cache s·∫Ω ƒë∆∞·ª£c 63.50RPS, v√† n·∫øu ch·ªâ c√≥ HTML/JS l√† 180.54 RPS.
M·ª©c gi√° n√†y kh√° r·∫ª, t·∫°i <a href="https://bit.ly/dohvn">DigitalOcean</a>,
c·∫•u h√¨nh t∆∞∆°ng ƒë∆∞∆°ng c√≥ gi√° 10USD/th√°ng. (Note: link refer, ƒëƒÉng k√Ω b·∫±ng link
n√†y ƒë∆∞·ª£c $100 mi·ªÖn ph√≠ cho b·∫°n, $20 cho Pymi.vn).
hay <a href="https://bizflycloud.vn/cloud-server/bang-gia">BIZFLY CLOUD</a> c·ªßa Vi·ªát Nam c≈©ng gi√° ~200.000.</li>
</ul>
<p>Ch√∫ √Ω: vi·ªác t√≠nh RPS th∆∞·ªùng t√≠nh trung b√¨nh, nh∆∞ng tr√™n th·ª±c t·∫ø, m·ªói website c√≥
m·ªôt "pattern" truy c·∫≠p kh√°c nhau. V√≠ d·ª• t·∫°i m·ªôt v√†i th·ªùi ƒëi·ªÉm trong ng√†y, s·∫Ω
c√≥ nhi·ªÅu ng∆∞·ªùi truy c·∫≠p ƒë·ªçc b√°o h∆°n l√† l√∫c 4h s√°ng. C√°c website th∆∞∆°ng m·∫°i ƒëi·ªán
t·ª≠ s·∫Ω lu√¥n "peak" khi ch·∫°y c√°c khuy·∫øn m√£i 6-6, 9-9, 11-11, black friday...
Con s·ªë m√† c√°c l·∫≠p tr√¨nh vi√™n/sysadmin quan t√¢m l√† RPS l√∫c peak, s·ªë truy c·∫≠p
ƒë·ªìng th·ªùi cao nh·∫•t m√† h·ªá th·ªëng ch·ªãu ƒë∆∞·ª£c.</p>
<h4>Concurrent User (CCU) - ƒë∆°n v·ªã m√† ch·ªß doanh nghi·ªáp quan t√¢m</h4>
<p>RPS mang t√≠nh ch·∫•t con s·ªë v·ªÅ m·∫∑t k·ªπ thu·∫≠t, nh∆∞ng khi truy c·∫≠p 1 website, ng∆∞·ªùi
d√πng th∆∞·ªùng th·ª±c hi·ªán nhi·ªÅu h∆°n 1 request. V√≠ d·ª• khi truy c·∫≠p
<a href="https://pymi.vn">https://pymi.vn</a>, tr√¨nh duy·ªát
s·∫Ω th·ª±c hi·ªán 8 requests (c√°c file HTML/CSS/Javascript/·∫£nh), c√≤n khi truy c·∫≠p
vnexpress.net, tr√¨nh duy·ªát th·ª±c hi·ªán t·ªõi 73 requests.</p>
<p>Ch·ªß doanh nghi·ªáp, website, ch·ªâ quan t√¢m con s·ªë mang t√≠nh ch·∫•t kinh t·∫ø,
l√† c√≥ bao nhi√™u ng∆∞·ªùi dang d√πng m√† kh√¥ng quan t√¢m c√≥ bao nhi√™u request, v·∫≠y
n√™n con s·ªë Concurrent User (CCU - s·ªë ng∆∞·ªùi truy c·∫≠p c√πng l√∫c) ra ƒë·ªùi.
Trong v√≠ d·ª• Rap Vi·ªát tr√™n, c√≥ 1 tri·ªáu ng∆∞·ªùi xem c√πng l√∫c - 1 tri·ªáu CCU.
1 tri·ªáu CCU t∆∞∆°ng ·ª©ng v·ªõi t·ªëi thi·ªÉu 1 tri·ªáu RPS, nh∆∞ng th∆∞·ªùng RPS cao h∆°n nhi·ªÅu l·∫ßn.</p>
<p>M·ªôt ƒëi·ªÅu ƒë√°ng n√≥i kh√°c, r·∫±ng kh√¥ng ph·∫£i 73 requests ƒë·ªÅu g·ªçi v√†o vnexpress.net m√†
g·ªçi ƒë·∫øn c√°c trang kh√°c ch·ª©a ·∫£nh, video...</p>
<p>Khi n√≥i v·ªÅ CCU, ch·ªß doanh nghi·ªáp c≈©ng kh√¥ng quan t√¢m h·ªá th·ªëng s·ª≠ d·ª•ng bao
nhi√™u m√°y t√≠nh ·ªü ƒë√¢y. N√≥i 1 tri·ªáu RPS, kh√¥ng c√≥ nghƒ©a l√† ph·∫£i d√πng 1 m√°y,
1 tri·ªáu RPS/m√°y l√† r·∫•t cao, tr√™n th·∫ø gi·ªõi <a href="https://blog.whatsapp.com/1-million-is-so-2011/?lang=en">Whatsapp ƒë√£ l√†m ƒë∆∞·ª£c 1m TCP conn t·ª´
2011</a>,
<a href="https://www.phoenixframework.org/blog/the-road-to-2-million-websocket-connections">Elixir Phoenix fullstack web-framework ch·∫°y 2 tri·ªáu websocket
connections</a>
nƒÉm 2015. Nh∆∞ng kh√¥ng ai c·∫•m b·∫°n ch·∫°y 200 m√°y sau load-balancer c·∫£.
1.000.000 / 200 = 5.000 RPS.</p>
<p><a href="https://en.wikipedia.org/wiki/C10k_problem">C10k</a> l√† 1 v·∫•n ƒë·ªÅ r·∫•t nƒÉm 2000, ƒë·ªÉ
x·ª≠ l√Ω 10.000 connection, c√πng v·ªõi s·ª± ra ƒë·ªùi c·ªßa NGINX.</p>
<h4>Response time - latency, p95, p99</h4>
<p>M·ªôt ƒë∆°n v·ªã quan tr·ªçng kh√°c khi n√≥i v·ªÅ t·ªëc ƒë·ªô website l√† <strong>response time</strong> t√™n
kh√°c l√† latency - th·ªùi
gian t√≠nh t·ª©c l√∫c ng∆∞·ªùi d√πng g·ª≠i request ƒëi cho t·ªõi khi nh·∫≠n ƒë∆∞·ª£c n·ªôi dung trang web.
Con s·ªë n√†y n√≥i ƒë∆°n gi·∫£n ch√≠nh l√† s·ª± nhanh/ch·∫≠m c·ªßa website.
Response time l√† 10 gi√¢y th√¨ ng∆∞·ªùi d√πng sau khi v√†o thanh ƒë·ªãa ch·ªâ g√µ enter, 10
gi√¢y sau m·ªõi nh√¨n th·∫•y n·ªôi dung trang web.
(ƒë·ªÉ th·∫•y TO√ÄN B·ªò n·ªôi dung trang web, ng∆∞·ªùi ta d√πng th√™m ƒë∆°n v·ªã ƒëo "load time")</p>
<p>Nh∆∞ng n·∫øu k·∫øt qu·∫£ response l√∫c nhanh l√∫c ch·∫≠m th√¨ bi·∫øt l·∫•y s·ªë n√†o? ƒë√≥ l√† l√∫c
c·∫ßn l√¥i b·ªô m√¥n <a href="https://medium.com/pymi/d%C3%B9ng-python-%C4%91%E1%BB%83-h%E1%BB%8Dc-th%E1%BB%91ng-k%C3%AA-8e41dfdaaf97">th·ªëng
k√™</a>
ra ƒë·ªÉ tr√¨nh b√†y. C√°ch ƒë∆°n gi·∫£n nh·∫•t l√† l·∫•y trung b√¨nh c·ªông,
nghe th√¨ d·ªÖ, nh∆∞ng k·∫øt qu·∫£ n√†y th∆∞·ªùng v√¥ d·ª•ng, b·ªüi (99*2) 198 l·∫ßn load 1s m√† 2 l·∫ßn 901s
th√¨ trung b√¨nh l√†: (99 * 2 + 901 * 2)/200 == 10s.</p>
<p>C√°ch l√†m ph·ªï bi·∫øn l√† d√πng quantile 99 (hay 95) ƒë·ªÉ ƒëo: t·ª©c gi√° tr·ªã m√†
99% c√°c gi√° tr·ªã kh√°c ƒë·ªÅu nh·ªè h∆°n ho·∫∑c b·∫±ng, c√≤n c√≥ t√™n g·ªçi p99 (99th percentile).
Trong v√≠ d·ª• tr√™n, p99 l√† 1: <code>int(99/100 * 200 s·ªë) = 198</code>, s·∫Øp x·∫øp c√°c s·ªë tƒÉng
d·∫ßn th√¨ s·ªë th·ª© 198 c√≥ gi√° tr·ªã l√† 1,
p100 √≠t khi ƒë∆∞·ª£c nh·∫Øc t·ªõi, ƒë√≥ l√† s·ªë l·ªõn nh·∫•t trong t·∫≠p.
Xem th√™m v·ªÅ quantile v√† percentile ·ªü ph·∫ßn link tham kh·∫£o.</p>
<p>T·∫°i sao l·∫°i b·ªè ƒëi 1% nh∆∞ v·∫≠y? v√¨ k·∫øt qu·∫£ ƒëo ƒë·∫°c c√≥ th·ªÉ c√≥ c√°c sai s·ªë do nhi·ªÅu
l√Ω do kh√°c nhau v√† kh√¥ng c√≥ √Ω nghƒ©a v·ªõi v·∫•n ƒë·ªÅ (ch·∫≠m do m·∫°ng b·ªã c√° m·∫≠p c·∫Øn
trong 1 request, ch·∫≥ng h·∫°n).</p>
<p>Gi√° tr·ªã latency g·∫ßn 0ms l√† kh·ªßng, 100ms l√† t·ªët, 500ms l√† OK, v√†i gi√¢y l√† l·ªüm,
nhi·ªÅu gi√¢y l√† r·∫•t kh√¥ng ra g√¨:</p>
<blockquote>
<p>~0ms is superb; 100ms is good; 500ms is okay; a few seconds is bad; and several seconds may be approaching awful. - www.techempower.com</p>
</blockquote>
<h3>T·ªëc ƒë·ªô l√Ω thuy·∫øt</h3>
<p>T∆∞∆°ng t·ª± website benchmark
t·ªëc ƒë·ªô t√≠nh to√°n c·ªßa c√°c ng√¥n ng·ªØ, c√≥ website benchmark c√°c webframework:
<a href="https://www.techempower.com/benchmarks/#section=data-r20">techempower</a></p>
<p>t·∫°i ƒë√¢y, m·ªói framework th·ª±c hi·ªán 7 lo·∫°i test v√† ƒë∆∞·ª£c ch·∫•m ƒëi·ªÉm, ƒë·∫ßu b·∫£ng h·∫ßu h·∫øt
l√† C++ hay Rust, lu√¥n d√†nh chi·∫øn th·∫Øng v·ªÅ t·ªëc ƒë·ªô, nh∆∞ng kh√¥ng m·∫•y ai l√†m web
site b·∫±ng C++ c·∫£.</p>
<blockquote>
<p>Nh·ªõ r·∫±ng: Instagram d√πng Django.</p>
</blockquote>
<p>C√°c web framework ph·ªï bi·∫øn c·ªßa Python h·∫ßu nh∆∞ ƒë·ªÅu ·ªü ph√≠a d∆∞·ªõi b·∫£ng x·∫øp h·∫°ng,
ngang ng·ª≠a v·ªõi Ruby/PHP</p>
<ul>
<li>Django (359/436)</li>
<li>Flask (370/436)</li>
<li>Ruby On Rails (377/436)</li>
<li>PHP Lavarel (388/436)</li>
</ul>
<p>Ri√™ng FastAPI c√πng khu v·ªõi Elixir, NodeJS, Java</p>
<ul>
<li>Go Gin (162/436)</li>
<li>FastAPI (247/436)</li>
<li>Elixir Phoenix (251/436)</li>
<li>NodeJS Express MySQL (287/436)</li>
<li>Java Spring (317/436)</li>
</ul>
<p>v·∫≠y k·∫øt lu·∫≠n d√πng <a href="http://pp.pymi.vn/article/go/">Go</a> ch·∫°y nhanh h∆°n v√† ƒë·∫≠p h·∫øt Django, Java, Ruby app ƒëi vi·∫øt
l·∫°i ?</p>
<p><strong>ƒê·ª´ng!</strong></p>
<p>K·∫øt qu·∫£ c·ªßa vi·ªác benchmark r·∫•t kh√≥ ƒë·ªÉ ƒë∆∞a ra k·∫øt lu·∫≠n, v√† t·ªëc ƒë·ªô th·ª±c s·ª± ph·ª•
thu·ªôc v√†o b√†i to√°n c·ª• th·ªÉ ch·ª© kh√¥ng ph·∫£i d·ª±a v√† k·∫øt lu·∫≠n "hello world" c·ªßa
framework.</p>
<p>D√π ƒëi·ªÉm trung b√¨nh c·ªßa Go + Gin framework (nhanh) h∆°n c·ªßa FastAPI, nh∆∞ng
khi xem t·ª´ng test c·ª• th·ªÉ, nh∆∞ test data update (c√≥ s·ª± ·∫£nh h∆∞·ªüng l·ªõn c·ªßa database)
th√¨ FastAPI b·ªè xa xa xa Go + Gin. Website c·ªßa b·∫°n c√≥ update DB kh√¥ng? h·∫ßu h·∫øt l√† c√≥, t√πy tr∆∞·ªùng
h·ª£p. Khi ch·ªâ ƒë∆°n thu·∫ßn t√≠nh to√°n v√† kh√¥ng ƒë·ªông v√†o DB, Go r√µ r√†ng d√†nh chi·∫øn th·∫Øng. Xem th√™m ph·∫ßn <a href="https://github.com/tiangolo/fastapi/issues/1664#issuecomment-653580642">th·∫Øc m·∫Øc v·ªÅ t·ªëc ƒë·ªô c·ªßa FastAPI t·∫°i ƒë√¢y</a>.</p>
<p>C√°c k·∫øt qu·∫£ benchmark d·ªÖ d√†ng b·ªã ƒë·∫£o ng∆∞·ª£c ch·ªâ v·ªõi v√†i thay ƒë·ªïi ph·ª• thu·ªôc b√†i to√°n, nh∆∞
tr∆∞·ªùng h·ª£p benchmark Flask sau:</p>
<ul>
<li><a href="https://calpaterson.com/async-python-is-not-faster.html">b√†i n√†y benchmark k·∫øt lu·∫≠n async Python kh√¥ng nhanh h∆°n sync</a></li>
<li><a href="https://blog.miguelgrinberg.com/post/ignore-all-web-performance-benchmarks-including-this-one">b√†i n√†y ch·ªânh s·ª≠a l·∫°i 1 ch√∫t, v√† cho k·∫øt qu·∫£ kh√°c ho√†n to√†n</a></li>
</ul>
<p>T√°c gi·∫£ <a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">Flask mega tutorial Miguel Grinberg</a> ch·ªâ ƒë∆∞a ra k·∫øt lu·∫≠n cu·ªëi c√πng v·ªõi t√™n b√†i vi·∫øt:</p>
<blockquote>
<p>Ignore All Web Performance Benchmarks, Including This One</p>
</blockquote>
<p>M·ªôt b√†i vi·∫øt kh√°c th·ª±c hi·ªán c·∫£i thi·ªán website d√πng <a href="https://suade.org/dev/12-requests-per-second-with-python/">Flask + SQLAlchemy ORM t·ª´ 12RPS th√†nh 75RPS</a>.</p>
<p>Trong c√°c trang web, t·ªëc ƒë·ªô c·ªßa website ph·∫ßn l·ªõn ph·ª• thu·ªôc v√†o database,
ki·∫øn tr√∫c, cache, h∆°n l√† ph·ª• thu·ªôc v√†o t·ªëc ƒë·ªô c·ªßa web framework.</p>
<h3>Load test Python</h3>
<p>C√°ch ƒë·ªÉ r√∫t ra ƒë∆∞·ª£c k·∫øt qu·∫£ chu·∫©n nh·∫•t, c√≥ √Ω nghƒ©a nh·∫•t l√† t·ª± ƒëo code c·ªßa m√¨nh.
C√¥ng c·ª• ƒë·ªÉ benchmark web site:</p>
<ul>
<li>ab (Apache benchmark tool) <code>sudo apt-get install apache2-utils</code></li>
<li><a href="https://github.com/rakyll/hey">Go hey</a></li>
<li><a href="https://github.com/wg/wrk">C wrk</a></li>
<li><a href="https://locust.io/">Python Locust.io + webUI + distributed + graph report</a></li>
</ul>
<p>Th·ª≠ benchmark code Flask+Gunicorn hello world, 1000 CCU:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/fast&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">fast</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;yes&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>$ gunicorn app:app -w <span class="m">9</span> -k gthread
</code></pre></div>

<p>R·ªìi ch·∫°y <code>wrk</code>:</p>
<div class="highlight"><pre><span></span><code>$ ./wrk -c <span class="m">1000</span> -d 10s http://localhost:8000/fast
Running 10s <span class="nb">test</span> @ http://localhost:8000/fast
  <span class="m">2</span> threads and <span class="m">1000</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   <span class="m">233</span>.14ms   <span class="m">61</span>.78ms <span class="m">371</span>.49ms   <span class="m">68</span>.27%
    Req/Sec     <span class="m">2</span>.13k   <span class="m">222</span>.09     <span class="m">2</span>.75k    <span class="m">67</span>.50%
  <span class="m">42372</span> requests <span class="k">in</span> <span class="m">10</span>.08s, <span class="m">6</span>.47MB <span class="nb">read</span>
Requests/sec:   <span class="m">4202</span>.64
Transfer/sec:    <span class="m">656</span>.75KB
</code></pre></div>

<p>4200rps v·ªõi latency avg 200ms, max c≈©ng ch·ªâ l√† 371ms.</p>
<p>hay <code>ab</code>:</p>
<div class="highlight"><pre><span></span><code>$  ab -n <span class="m">10000</span> -c <span class="m">1000</span> http://localhost:8000/fast

Concurrency Level:      <span class="m">1000</span>
Requests per second:    <span class="m">3706</span>.73 <span class="o">[</span><span class="c1">#/sec] (mean)</span>

Percentage of the requests served within a certain <span class="nb">time</span> <span class="o">(</span>ms<span class="o">)</span>
  <span class="m">50</span>%    <span class="m">264</span>
  <span class="m">66</span>%    <span class="m">293</span>
  <span class="m">75</span>%    <span class="m">312</span>
  <span class="m">80</span>%    <span class="m">327</span>
  <span class="m">90</span>%    <span class="m">360</span>
  <span class="m">95</span>%    <span class="m">397</span>
  <span class="m">98</span>%    <span class="m">426</span>
  <span class="m">99</span>%    <span class="m">448</span>
 <span class="m">100</span>%    <span class="m">476</span> <span class="o">(</span>longest request<span class="o">)</span>
</code></pre></div>

<p>Test tr√™n</p>
<div class="highlight"><pre><span></span><code>AMD Ryzen <span class="m">3</span> 4300U - <span class="m">4</span> cores - 8GB RAM

$ lsb_release -d<span class="p">;</span> python3 --version
Description:    Ubuntu <span class="m">20</span>.04.3 LTS
Python <span class="m">3</span>.8.10


Flask               <span class="m">2</span>.0.1
gunicorn            <span class="m">20</span>.1.0

$ ./wrk --version
wrk a211dd5 <span class="o">[</span>epoll<span class="o">]</span> Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2012</span> Will Glozer
</code></pre></div>

<h2>Python trong h·ªá th·ªëng</h2>
<p>V√†i tr∆∞·ªùng h·ª£p minh h·ªça code Python vi·∫øt r·∫•t nhanh v√† ch·∫°y ƒë·ªß nhanh:</p>
<ul>
<li><a href="https://pp.pymi.vn/article/10x/">Khi s·ª≠ d·ª•ng Kafka trong b√†i tƒÉng t·ªëc ƒë·ªô
10x</a>, d√πng th∆∞ vi·ªán
https://github.com/confluentinc/confluent-kafka-python, b√™n d∆∞·ªõi th·ª±c ch·∫•t g·ªçi code C librdkafka,
thay Python b·∫±ng code Go <a href="https://github.com/confluentinc/confluent-kafka-go/issues/490#issuecomment-655339047">kh√¥ng l√†m nhanh
h∆°n</a>,
<a href="https://github.com/confluentinc/confluent-kafka-go/issues/567">th·∫≠m ch√≠ c√≤n ch·∫≠m
h∆°n</a>, gi·∫£i ph√°p
c√≥ th·ªÉ l√†
t√¨m m·ªôt th∆∞ vi·ªán Kafka vi·∫øt b·∫±ng Go r·ªìi benchmark l·∫°i.</li>
<li>Code C++ th∆∞·ªùng ƒë∆∞·ª£c coi l√† <strong>hi·ªÉn nhi√™n</strong> nhanh h∆°n Python, <a href="https://stackoverflow.com/questions/9371238/why-is-reading-lines-from-stdin-much-slower-in-c-than-python?rq=1">nh∆∞ng ph·∫£i bi·∫øt
b·∫≠t t·∫Øt ƒë√∫ng th·ª© kh√¥ng s·∫Ω ch·∫≠m h∆°n</a></li>
<li><a href="https://stackoverflow.com/questions/14205096/c11-regex-slower-than-python">c++11 regex slower than python - v√† nh·ªõ r·∫±ng tuy n√≥i l√† Python, nh∆∞ng r·∫•t nhi·ªÅu ch·ªó c·ªßa Python th·ª±c ch·∫•t g·ªçi code C b√™n d∆∞·ªõi</a></li>
</ul>
<h2>Python trong x·ª≠ l√Ω data</h2>
<p>C√°c th∆∞ vi·ªán t√≠nh to√°n khoa h·ªçc trong Python ƒë·ªÅu s·ª≠ d·ª•ng c√°c ng√¥n ng·ªØ t√≠nh to√°n
nhanh b√™n d∆∞·ªõi, nh∆∞ Numpy/Pandas d√πng C, PyTorch/Tensorflow d√πng C++. K·∫øt h·ª£p
v·ªõi c√∫ ph√°p Python ·ªü tr√™n, t·∫°o n√™n s·ª± ho√†n h·∫£o c·ªßa c·∫£ 2 th·∫ø gi·ªõi: code ƒë·∫πp, ƒë∆°n
gi·∫£n c·ªßa Python, v√† t√≠nh nhanh (g·∫ßn) nh∆∞ C/C++/Fortran.</p>
<h2>K·∫øt lu·∫≠n</h2>
<p>ƒê·ªçc k·∫øt qu·∫£ benchmark tr√™n m·∫°ng r·ªìi ƒë∆∞a ra k·∫øt lu·∫≠n l√† m·ªôt vi·ªác l√†m r·∫•t nguy hi·ªÉm,
n√™n t·ª± h·ªçc c√°ch benchmark cho tr∆∞·ªùng h·ª£p c·ª• th·ªÉ c·ªßa m√¨nh.</p>
<p>T·ªëc ƒë·ªô c·ªßa ng√¥n ng·ªØ l·∫≠p tr√¨nh &amp; framework tr√™n th·ª±c t·∫ø th∆∞·ªùng kh√¥ng quan tr·ªçng
b·∫±ng: t·ªëc ƒë·ªô ph√°t tri·ªÉn t√≠nh nƒÉng/ d·ª± √°n, chi ph√≠ b·ªè ra ƒë·ªÉ vi·∫øt l·∫°i b·∫±ng
m·ªôt ng√¥n ng·ªØ X ch·∫°y nhanh h∆°n.</p>
<h2>References</h2>
<ul>
<li><a href="https://www.familug.org/p/ung-ho.html">·ª¶ng h·ªô t√°c gi·∫£ üç∫</a></li>
<li><a href="https://www.techempower.com/blog/2016/02/10/think-about-performance-before-building-a-web-application/">techempower - Think about Performance Before Building a Web Application</a></li>
<li><a href="https://www.pingdom.com/blog/page-load-time-vs-response-time-what-is-the-difference/">page load time vs response time</a></li>
<li><a href="https://en.wikipedia.org/wiki/Quantile">Quantile</a></li>
<li><a href="https://en.wikipedia.org/wiki/Percentile">Percentile</a></li>
<li><a href="https://github.com/tiangolo/fastapi/issues/1664#issuecomment-653580642">FastAPI is fast</a></li>
<li><a href="https://stackoverflow.com/questions/14205096/c11-regex-slower-than-python">c11-regex-slower-than-python</a></li>
<li><a href="https://stackoverflow.com/questions/9371238/why-is-reading-lines-from-stdin-much-slower-in-c-than-python?rq=1">why-is-reading-lines-from-stdin-much-slower-in-c-than-python</a></li>
</ul>
<p>HVN at <a href="http://pymi.vn">http://pymi.vn</a> and <a href="https://www.familug.org">https://www.familug.org</a></p>
  </div>
  <!-- /.entry-content -->
</section>
<section class="container">
  <div class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'pymier';
      var disqus_identifier = 'article/slow/';
      var disqus_url = 'http://pp.pymi.vn/article/slow/';
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//pymier.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the comments.</noscript>
  </div>
</section>

    <section class="container footer">
      <footer>
        <address>
        Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
        which takes great advantage of <a href="http://python.org">Python</a>.
        </address>
        <address>
          H·ªçc l·∫≠p tr√¨nh Python t·∫°i <a href="https://pymi.vn/">Pymi.vn</a>
        </address>
      </footer>
    </section>
  </main>

<script type="text/javascript">
var images = document.getElementsByTagName("img");
var i;

for(i = 0; i < images.length; i++) {
  images[i].className += " centered";
}
</script>
</body>

</html>