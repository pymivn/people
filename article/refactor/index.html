<!DOCTYPE html>
<html lang="vi">

<head>
   <title> Refactor 10 d√≤ng code th√†nh 90 d√≤ng  - The PyMiers</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="robots" content="" />
  <link rel="stylesheet" type="text/css" href="/theme/css/app.css">
<link rel="stylesheet" type="text/css" href="http://pp.pymi.vn/theme/css/pygment.css">
  <!--
  <link href="https://fonts.googleapis.com/css?family=Fira+Sans" rel="stylesheet">
  -->

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">    <meta name="author" content="Pymiers" />
  <meta name="description" content="" />    <link href="http://pp.pymi.vn/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="The PyMiers Full Atom Feed" />         
  <meta name="tags" content="python" />
  <meta name="tags" content="refactor" />
  <meta name="tags" content="software engineering" />
  <meta name="tags" content="test" />
  <meta name="tags" content="rust" />
</head>

<body>
  <main class="wrapper">
    <section class="container">
      <header class='column'>
        <h1 class='title'><a href="http://pp.pymi.vn/">The PyMiers</a></h1>
      </header>

      <div class="section">
        <div class="row navbar">
          <div class="column nav-item is-active"><a href="http://pp.pymi.vn/category/trang-chu/">Trang ch·ªß</a></div>
           <div class="column nav-item "><a href="http://pp.pymi.vn/pages/about/">About</a></div>
          <div class="column nav-item "><a href="http://pp.pymi.vn/pages/add/">T·∫°o b√†i vi·∫øt</a></div>
          <div class="column nav-item "><a href="http://pp.pymi.vn/pages/rss/">RSS</a></div>
          <div class="column nav-item"><a href="/archives">Archives</a></div>
        </div>
      </div>
    </section>

<section class="container">
  <header>
    <h2 class="entry-title">
      <a href="http://pp.pymi.vn/article/refactor/" rel="bookmark"
         title="Permalink to Refactor 10 d√≤ng code th√†nh 90 d√≤ng">Refactor 10 d√≤ng code th√†nh 90 d√≤ng</a></h2>  
  </header>
  <footer class='center'>
    <time class="published" datetime="2023-05-09T00:00:00+07:00"> 09/05/2023 </time>
    <address class="vcard author">By
                    <a class="url fn" href="http://pp.pymi.vn/author/hvnsweeting/">hvnsweeting</a>
 in <a href="http://pp.pymi.vn/category/trang-chu/">Trang ch·ªß</a>
                </address>     <em>Tags</em>:     <a href="http://pp.pymi.vn/tag/python/"><em>python</em></a>,     <a href="http://pp.pymi.vn/tag/refactor/"><em>refactor</em></a>,     <a href="http://pp.pymi.vn/tag/software-engineering/"><em>software engineering</em></a>,     <a href="http://pp.pymi.vn/tag/test/"><em>test</em></a>,     <a href="http://pp.pymi.vn/tag/rust/"><em>rust</em></a>    </footer>
  <br>
  <div class="entry-content">
    <p>Refactor l√† m·ªôt ph·∫ßn c√¥ng vi·ªác kh√¥ng th·ªÉ thi·∫øu c·ªßa l·∫≠p tr√¨nh vi√™n, sau khi code xong ch·∫°y ƒë∆∞·ª£c m√† "ch∆∞a ƒë·∫πp", l·∫≠p tr√¨nh vi√™n s·∫Ω ch·ªânh s·ª≠a ƒëo·∫°n code cho "ƒë·∫πp" h∆°n, c≈©ng c√≥ th·ªÉ nhanh h∆°n, c≈©ng c√≥ th·ªÉ ng·∫Øn h∆°n, c≈©ng c√≥ th·ªÉ d·ªÖ hi·ªÉu h∆°n...</p>
<p>V·∫•n ƒë·ªÅ v·ªõi refactor: l√† m·ªôt kh√°i ni·ªám chung chung, kh√¥ng c√≥ v√≠ d·ª• c·ª• th·ªÉ, kh√≥ h·ªçc/luy·ªán t·∫≠p ƒë·ªÉ tr·ªü th√†nh 1 k·ªπ nƒÉng. Best-practice c·ªßa ng√¥n ng·ªØ n√†y l·∫°i c√≥ th·ªÉ l√† ƒëi·ªÅu kh√¥ng ai l√†m ·ªü ng√¥n ng·ªØ kh√°c. S√°ch v·ªü vi·∫øt v·ªÅ refactor c≈©ng ch·ªâ c√≥ 1 quy·ªÉn ƒë∆∞·ª£c c·ªông ƒë·ªìng m·∫°ng nh·∫Øc t·ªõi ?!!! <a href="https://martinfowler.com/books/refactoring.html">Refactoring - Improving the Design of Existing Code by Martin Fowler, with Kent Beck, 2018</a>.  PyMi c≈©ng t·ª´ng c√≥ 1 b√†i vi·∫øt gi·ªõi thi·ªáu vi·ªác <a href="http://pp.pymi.vn/article/repl/">refactoring code k√®m v·ªõi IPython</a>.</p>
<p><center>
<img alt="Refactor" src="https://images.unsplash.com/photo-1545697729-0ab8f5b1954c?ixlib=rb-4.0.3&amp;q=85&amp;fm=jpg&amp;crop=entropy&amp;cs=srgb&amp;dl=zoltan-tasi-CLJeQCr2F_A-unsplash.jpg&amp;w=640"></p>
<p>Photo by <a href="https://unsplash.com/@zoltantasi?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Zoltan Tasi</a> on <a href="https://unsplash.com/photos/CLJeQCr2F_A?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a></center></p>
<p>B√†i vi·∫øt n√†y d·ª±a tr√™n chapter 12 trong cu·ªën <a href="https://doc.rust-lang.org/book/ch12-03-improving-error-handling-and-modularity.html">The Rust Programming Language</a> (c√≤n hay g·ªçi l√† <strong>The book</strong>), k√®m ph√≥ng t√°c, chuy·ªÉn d·ªãch sang Python, th√™m "b√¨nh ph·∫©m" v√† nhi·ªÅu nhi·ªÅu c√¢u h·ªèi. S·ª≠ d·ª•ng v√≠ d·ª• t·ª´ s√°ch Rust khi·∫øn ng∆∞·ªùi ƒë·ªçc c√≥ th·ªÉ tin c·∫≠y tr√¨nh ƒë·ªô c·ªßa t√°c gi·∫£... Steve Klabnik, Carol Nichols - nh·ªØng c√°i t√™n n·ªïi ti·∫øng b·∫≠c nh·∫•t trong th·∫ø gi·ªõi Rust.</p>
<h3>Refactoring l√† g√¨</h3>
<p>Trong ti·∫øng Anh, refactoring c√≥ nghƒ©a:</p>
<p><a href="https://dictionary.cambridge.org/dictionary/english/refactoring">cambridge</a>:</p>
<blockquote>
<p>refactoring isn‚Äôt in the Cambridge Dictionary yet. You can help!</p>
</blockquote>
<p><a href="https://www.dictionary.com/misspelling?term=refactoring">dictionary.com</a>:</p>
<blockquote>
<p>No results found for refactoring</p>
</blockquote>
<p>theo t·ª´ ƒëi·ªÉn ti·∫øng Anh, t·ª´ <strong>refactoring</strong> kh√¥ng t·ªìn t·∫°i.</p>
<p>Theo <a href="https://en.wikipedia.org/wiki/Code_refactoring">Wikipedia</a>:</p>
<blockquote>
<p>In computer programming and software design, code refactoring is the process of restructuring existing computer code‚Äîchanging the factoring‚Äîwithout changing its external behavior</p>
</blockquote>
<p>l√† vi·ªác ch·ªânh s·ª≠a l·∫°i code ƒë√£ t·ªìn t·∫°i m√† kh√¥ng thay ƒë·ªïi t√≠nh nƒÉng c·ªßa code.</p>
<p>Theo qu·∫£ng c√°o c·ªßa cu·ªën s√°ch v·ªÅ <a href="https://martinfowler.com/books/refactoring.html">Refactoring</a> n·ªëi ti·∫øng nh·∫•t:</p>
<blockquote>
<p>Refactoring is a controlled technique for improving the design of an existing code base. Its essence is applying a series of small behavior-preserving transformations, each of which "too small to be worth doing". However the cumulative effect of each of these transformations is quite significant. By doing them in small steps you reduce the risk of introducing errors. You also avoid having the system broken while you are carrying out the restructuring - which allows you to gradually refactor a system over an extended period of time.</p>
</blockquote>
<p>·ªû ƒë√¢y d√πng <strong>refactoring</strong> nh∆∞ 1 danh t·ª´, <strong>refactor</strong> nh∆∞ 1 ƒë·ªông t·ª´.</p>
<h3>Refactoring ƒë·ªÉ l√†m g√¨</h3>
<p>Refactor ƒë·ªÉ c·∫£i thi·ªán, n√¢ng cao</p>
<ul>
<li>T√≠nh d·ªÖ b·∫£o tr√¨, fix bug: Maintainability.</li>
<li>T√≠nh d·ªÖ m·ªü r·ªông/thay ƒë·ªïi: Extensibility.</li>
<li>T·ªëc ƒë·ªô ch·∫°y: Performance.</li>
</ul>
<h3>V√≠ d·ª• refactor 10 d√≤ng code</h3>
<p>Vi·∫øt 1 ch∆∞∆°ng tr√¨nh gi·ªëng nh∆∞ c√¢u l·ªánh grep tr√™n UNIX, t·ª©c nh·∫≠n 2 ƒë·∫ßu v√†o tr√™n d√≤ng l·ªánh l√† "t·ª´ kh√≥a t√¨m ki·∫øm" v√† t√™n file, in ra m√†n h√¨nh c√°c d√≤ng ch·ª©a t·ª´ kh√≥a ·∫•y.
V√≠ d·ª• t√¨m t·ª´ <code>root</code> trong file <code>/etc/passwd</code> tr√™n Ubuntu, MacOS,...</p>
<div class="highlight"><pre><span></span><code>$ grep root /etc/passwd
root:x:0:0::/root:/bin/bash
</code></pre></div>

<p>Code Python 10 d√≤ng, kh√¥ng t√≠nh ngo√†i function main, d·ªãch tr·ª±c ti·∫øp t·ª´ <a href="https://doc.rust-lang.org/book/ch12-00-an-io-project.html">v√≠ d·ª• Rust</a>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># $ python3 grep.py root /etc/passwd</span>
<span class="c1"># root:x:0:0::/root:/bin/bash</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Should have been able to read the file&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p>Code n√†y ho√†n to√†n ·ªïn: s·∫°ch ƒë·∫πp, ƒë√∫ng chu·∫©n PEP8, v√† quan tr·ªçng nh·∫•t: ch·∫°y ra ƒë√∫ng k·∫øt qu·∫£.  V·∫≠y c√≥ c·∫ßn refactor kh√¥ng?  T√πy.
ƒê√≥ l√† ch·ªó kh√≥ khi n√≥i v·ªÅ refactoring, kh√¥ng c√≥ g√¨ r√µ r√†ng, ch√≠nh x√°c, m·ªçi th·ª© ƒë·ªÅu "t√πy".
T√πy v√†o:</p>
<ul>
<li>ch∆∞∆°ng tr√¨nh nh·ªè hay to, 10 d√≤ng hay 10000 d√≤ng</li>
<li>ch∆∞∆°ng tr√¨nh d√πng 1 l·∫ßn hay trong d·ª± √°n 1 nƒÉm ++</li>
<li>ch·∫°y 1 gi√¢y hay ch·∫°y 1 gi·ªù m·ªõi xong</li>
<li>team 1 ng∆∞·ªùi hay 10 ng∆∞·ªùi code c√πng</li>
</ul>
<p>Trong v√≠ d·ª• c·ª• th·ªÉ n√†y, ƒëo·∫°n code tr√™n ho√†n to√†n kh√¥ng c·∫ßn refactor. Nh∆∞ng ƒë√¢y l√† b√†i vi·∫øt v·ªÅ refactor, h√£y xem t√°c gi·∫£ s·∫Ω bi·∫øn ƒëo·∫°n code n√†y th√†nh 90 d√≤ng ra sao.</p>
<h4>4+1 v·∫•n ƒë·ªÅ c·ªßa ƒëo·∫°n code</h4>
<ul>
<li>Function <code>main</code> th·ª±c hi·ªán 2 c√¥ng vi·ªác kh√°c nhau. Khi ch∆∞∆°ng tr√¨nh l·ªõn l√™n, <code>main</code> s·∫Ω th·ª±c hi·ªán th√™m nhi·ªÅu c√¥ng vi·ªác n·ªØa khi·∫øn cho n√≥ kh√≥ hi·ªÉu, kh√≥ test, kh√≥ thay ƒë·ªïi 1 c√¥ng vi·ªác m√† kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn c√°c c√¥ng vi·ªác kh√°c. Kh√¥ng test ƒë∆∞·ª£c: c√°ch duy nh·∫•t ƒë·ªÉ bi·∫øt t·ª´ng ƒëo·∫°n code trong main ch·∫°y ƒë√∫ng hay sai l√† ch·∫°y th·ª≠ n√≥, v·ªõi nhi·ªÅu ƒë·∫ßu v√†o kh√°c nhau v√† d√πng m·∫Øt ki·ªÉm tra k·∫øt qu·∫£.  N√™n t·ªët nh·∫•t l√† t√°ch ra th√†nh m·ªói function th·ª±c hi·ªán duy nh·∫•t 1 c√¥ng vi·ªác + c√≥ th·ªÉ vi·∫øt unittest.</li>
<li>Bi·∫øn <code>query</code> v√† <code>file_path</code> l√† "configuration" c·ªßa ch∆∞∆°ng tr√¨nh, bi·∫øn <code>contents</code> d√πng ƒë·ªÉ th·ª±c hi·ªán logic. Khi <code>main</code> d√†i h∆°n, s·∫Ω c·∫ßn nhi·ªÅu bi·∫øn h∆°n, khi c√≥ nhi·ªÅu bi·∫øn h∆°n, s·∫Ω kh√≥ ƒë·ªÉ nh·ªõ/theo d√µi m·ª•c ƒë√≠ch c·ªßa t·ª´ng bi·∫øn. N√™n t·ªët nh·∫•t l√† g·ªôp c√°c bi·∫øn configuration v√†o 1 struct (class) ƒë·ªÉ khi·∫øn m·ª•c ƒë√≠ch c·ªßa ch√∫ng r√µ r√†ng.</li>
<li>D√π code ƒë√£ in ra th√¥ng b√°o khi c√≥ exception l√∫c ƒë·ªçc file, nh∆∞ng c√≥ h∆°n 1 l√Ω do c√≥ x·∫£y ra exception khi ƒë·ªçc file: file kh√¥ng t·ªìn t·∫°i, kh√¥ng c√≥ quy·ªÅn ƒë·ªÉ ƒë·ªçc file... In ra n·ªôi dung "kh√¥ng m·ªü ƒë∆∞·ª£c file" kh√¥ng h·ªÅ c√≥ √≠ch cho ng∆∞·ªùi d√πng bi·∫øt v·∫•n ƒë·ªÅ th·ª±c s·ª± l√† g√¨.</li>
<li>Khi ng∆∞·ªùi d√πng kh√¥ng ƒë∆∞a v√†o ƒë·ªß 2 ƒë·∫ßu v√†o tr√™n d√≤ng l·ªánh, s·∫Ω x·∫£y ra IndexError, exception n√†y kh√¥ng gi·∫£i th√≠ch r√µ r√†ng t·ªõi ng∆∞·ªùi d√πng chuy·ªán g√¨ x·∫£y ra. T·ªët nh·∫•t l√† ƒë·∫∑t <strong>t·∫•t c·∫£</strong> code x·ª≠ l√Ω exception v√†o chung 1 ch·ªó ƒë·ªÉ sau n√†y ch·ªâ c·∫ßn xem 1 ch·ªó n·∫øu logic x·ª≠ l√Ω exception c·∫ßn thay ƒë·ªïi, ƒë·ªìng th·ªùi gi√∫p hi·ªÉn th·ªã n·ªôi dung l·ªói r√µ r√†ng d·ªÖ hi·ªÉu h∆°n t·ªõi ng∆∞·ªùi d√πng.</li>
<li>ƒêo·∫°n n√†y kh√¥ng c√≥ trong b·∫£n Rust: vi·ªác ƒë·ªçc to√†n b·ªô n·ªôi dung file v√†o RAM v·ªõi <code>f.read()</code> l√† m·ªôt "code smell", khi·∫øn ƒëo·∫°n code n√†y kh√¥ng x·ª≠ l√Ω ƒë∆∞·ª£c file c√≥ k√≠ch th∆∞·ªõc l·ªõn h∆°n RAM.</li>
</ul>
<h4>Th·ª±c hi·ªán refactoring</h4>
<p>Function <code>main</code> ch·ªâ n√™n gi·ªõi h·∫°n t√≠nh nƒÉng:</p>
<ul>
<li>g·ªçi function x·ª≠ l√Ω c√°c ƒë·∫ßu v√†o t·ª´ d√≤ng l·ªánh</li>
<li>setup c√°c configuration (c·∫•u h√¨nh) kh√°c</li>
<li>g·ªçi <code>run</code> function trong file kh√°c, v√≠ d·ª• lib.py</li>
<li>x·ª≠ l√Ω exception c√≥ th·ªÉ x·∫£y ra</li>
</ul>
<h5>T√°ch code x·ª≠ l√Ω ƒë·∫ßu v√†o</h5>
<p>Vi·∫øt function <code>parse_config</code> nh·∫≠n c√°c argument, tr·∫£ v·ªÅ:</p>
<ul>
<li>tuple c√°c config: <code>(query, content)</code>, nh∆∞ng function <code>main</code> g·ªçi <code>parse_config</code> s·∫Ω l·∫°i unpacking tuple n√†y th√†nh c√°c bi·∫øn kh√°c nhau. ƒê√¢y l√† d·∫•u hi·ªáu c·ªßa vi·ªác s·ª≠ d·ª•ng ch∆∞a ƒë√∫ng "abstraction". Vi·ªác tr·∫£ v·ªÅ tuple c≈©ng kh√¥ng "g·∫Øn" ƒë∆∞·ª£c <code>query</code> v√† <code>file_path</code> v√†o v·ªõi config. V·∫≠y n√™n</li>
<li>tr·∫£ v·ªÅ 1 dictionary ho·∫∑c 1 Config object (Config class instance). ·ªû ƒë√¢y s·∫Ω tr·∫£ v·ªÅ 1 Config object cho gi·ªëng v√≠ d·ª• trong Rust.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>

<span class="k">def</span> <span class="nf">parse_config</span><span class="p">(</span><span class="n">argv</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="p">:</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Config</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">parse_config</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Should have been able to read the file&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">query</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div>

<h5>setup c√°c configuration (c·∫•u h√¨nh) kh√°c</h5>
<p>Gi·∫£ s·ª≠ ch∆∞∆°ng tr√¨nh s·∫Ω nh·∫≠n th√™m bi·∫øn environment (m√¥i tr∆∞·ªùng) <code>IGNORE_CASE</code>, n·∫øu ƒë∆∞·ª£c set, ch∆∞∆°ng tr√¨nh s·∫Ω kh√¥ng ph√¢n bi·ªát ch·ªØ hoa ch·ªØ th∆∞·ªùng khi t√¨m ki·∫øm. ƒê√¢y l√† v√≠ d·ª• v·ªÅ ch∆∞∆°ng tr√¨nh c√≥ th·ªÉ nh·∫≠n config t·ª´ nhi·ªÅu ngu·ªìn kh√°c nhau, ta ch·ªâ c·∫ßn thay ƒë·ªïi class <code>Config</code> v√† <code>parse_config</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">ignore_case</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_case</span> <span class="o">=</span> <span class="n">ignore_case</span>

<span class="k">def</span> <span class="nf">parse_config</span><span class="p">(</span><span class="n">argv</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="p">:</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ignore_case</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IGNORE_CASE&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Config</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">ignore_case</span><span class="p">)</span>
</code></pre></div>

<h5>g·ªçi run function trong file kh√°c, v√≠ d·ª• lib.py</h5>
<p>T√°ch to√†n b·ªô logic c·ªßa ch∆∞∆°ng tr√¨nh, ngo·∫°i tr·ª´ ph·∫ßn x·ª≠ l√Ω exception ra 1 file kh√°c t√™n <code>lib.py</code> v√† ƒë·∫∑t t√™n function l√† <code>run</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># lib.py</span>
<span class="c1"># Class Config...</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">query</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">lib</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">parse_config</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">lib</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Should have been able to read the file&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Gi·ªù ƒë√¢y <code>run</code> l·∫°i g·∫∑p v·∫•n ƒë·ªÅ c·ªßa <code>main</code>: l√†m nhi·ªÅu vi·ªác, nh∆∞ng √≠t ra n√≥ c≈©ng chia b·ªõt 2 vi·ªác cho <code>main</code> l√† parse config v√† x·ª≠ l√Ω exception. Khi m·ªôt ch∆∞∆°ng tr√¨nh <code>run</code>, n√≥ c√≥ th·ªÉ th·ª±c hi·ªán nhi·ªÅu vi·ªác kh√°c nhau, ·ªü ƒë√¢y ti·∫øp t·ª•c t√°ch m·ªói vi·ªác th√†nh 1 function ri√™ng. Vi·ªác ƒë·ªçc file kh√¥ng ph·ª©c t·∫°p h∆°n 1 d√≤ng n√™n ƒë·ªÉ nguy√™n, vi·ªác t√¨m ki·∫øm string t√°ch ra th√†nh function <code>search</code>. Function <code>search</code> thay v√¨ print, s·∫Ω tr·∫£ v·ªÅ 1 list ch·ª©a c√°c string ch·ª©a t·ª´ kh√≥a t√¨m ki·∫øm, ƒë·ªÉ vi·ªác print l·∫°i cho <code>run</code>. Nh∆∞ v·∫≠y c√≥ th·ªÉ vi·∫øt unittest ki·ªÉm tra logic c·ªßa function quan tr·ªçng n√†y thay v√¨ ki·ªÉm tra b·∫±ng m·∫Øt.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">search</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div>

<p>Test:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">import</span> <span class="nn">lib</span>

<span class="k">class</span> <span class="nc">TestGrep</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_search_found</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;us&quot;</span><span class="p">,</span> <span class="s2">&quot;Among us</span><span class="se">\n</span><span class="s2">Some write Rust</span><span class="se">\n</span><span class="s2">Some write promt</span><span class="se">\n</span><span class="s2">All write Python&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Among us&quot;</span><span class="p">,</span> <span class="s2">&quot;Some write Rust&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_search_not_found</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;HTML&quot;</span><span class="p">,</span> <span class="s2">&quot;Among us</span><span class="se">\n</span><span class="s2">Some write Rust</span><span class="se">\n</span><span class="s2">Some write promt</span><span class="se">\n</span><span class="s2">All write Python&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div>

<p>Ch·∫°y test:</p>
<div class="highlight"><pre><span></span><code><span class="c">$ python3 </span><span class="nb">-</span><span class="c">m unittest test_grep</span><span class="nt">.</span><span class="c">py </span><span class="nb">-</span><span class="c">vvv</span>
<span class="c">test_search_found (test_grep</span><span class="nt">.</span><span class="c">TestGrep) </span><span class="nt">...</span><span class="c"> ok</span>
<span class="c">test_search_not_found (test_grep</span><span class="nt">.</span><span class="c">TestGrep) </span><span class="nt">...</span><span class="c"> ok</span>

<span class="nb">----------------------------------------------------------------------</span><span class="c"></span>
<span class="c">Ran 2 tests in 0</span><span class="nt">.</span><span class="c">000s</span>

<span class="c">OK</span>
</code></pre></div>

<h5>Th√™m t√≠nh nƒÉng d·ªÖ d√†ng nh·ªù refactor</h5>
<p>CH√ö √ù: th√™m t√≠nh nƒÉng kh√¥ng n·∫±m trong ph·∫°m vi refactor, ·ªü ƒë√¢y minh h·ªça t√°c d·ª•ng c·ªßa vi·ªác refactor.</p>
<p>Khi m·ªçi t√≠nh nƒÉng c∆° b·∫£n ƒë√£ ·ªïn ƒë·ªãnh, vi·∫øt th√™m code ƒë·ªÉ x·ª≠ l√Ω khi ng∆∞·ªùi d√πng set env <code>IGNORE_CASE</code>. C√≥ 2 c√°ch x·ª≠ l√Ω:</p>
<ul>
<li>th√™m 1 boolean argument cho function search, <code>search(query, contents, ignore_case=False)</code>. Vi·ªác d√πng boolean argument c√≤n ƒë∆∞·ª£c g·ªçi l√† <a href="https://martinfowler.com/bliki/FlagArgument.html">flag argument</a> th∆∞·ªùng ƒë∆∞·ª£c xem nh∆∞ <a href="http://www.informit.com/articles/article.aspx?p=1392524">code smell</a> v√¨ n√≥ √°m ch·ªâ function n√†y l√†m nhi·ªÅu h∆°n 1 vi·ªác. Trong tr∆∞·ªùng h·ª£p n√†y, khi <code>ignore_case=True</code> s·∫Ω ch·ªâ g·ªçi th√™m 1 method (<code>lower()</code>) v·ªõi m·ªói d√≤ng, ch·ª© kh√¥ng "l√†m vi·ªác kh√°c" n√™n argument n√†y ho√†n to√†n OK. M·ªôt v√≠ d·ª• t∆∞∆°ng t·ª±, trong Python sort, c√≥ argument <code>reverse=True</code> ho·∫∑c <code>False</code> ƒë·ªÉ thay ƒë·ªïi th·ª© t·ª± s·∫Øp x·∫øp.</li>
<li>vi·∫øt 1 function ri√™ng <code>search_case_insensitive(query, contents)</code>, t√°c gi·∫£ ch·ªçn ph∆∞∆°ng √°n n√†y m√† kh√¥ng gi·∫£i th√≠ch t·∫°i sao. Nh∆∞·ª£c ƒëi·ªÉm c·ªßa ph∆∞∆°ng √°n n√†y l√† n·∫øu ph·∫ßn code chung c·ªßa 2 function l√† 30 b∆∞·ªõc, s·∫Ω ph·∫£i copy l·∫°i ph·∫ßn code chung. Nh∆∞ng c≈©ng c√≥ th·ªÉ c·∫£i thi·ªán b·∫±ng vi·ªác t√°ch ri√™ng ra 1 function n·ªØa nh∆∞ <code>search_internal</code> m√† c·∫£ 2 <code>search</code>, <code>search_case_insensitive</code> c√πng g·ªçi.</li>
</ul>
<p>·ªû ƒë√¢y ta s·∫Ω l√†m gi·ªëng nh∆∞ v√≠ d·ª• trong phi√™n b·∫£n Rust:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">search_case_insensitive</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>

<h5>X·ª≠ l√Ω exception</h5>
<p><code>main</code> c·∫ßn x·ª≠ l√Ω exception t·ª´ 2 function <code>parse_config</code> v√† <code>run</code>, ri√™ng bi·ªát, ƒë·ªÉ l√†m r√µ h∆°n c√°c exception ƒë√£ x·∫£y ra, ta t·∫°o ra exception cho t·ª´ng l·ªói c·ª• th·ªÉ.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_config</span><span class="p">(</span><span class="n">argv</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="p">:</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ignore_case</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IGNORE_CASE&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Config</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">ignore_case</span><span class="p">)</span>
</code></pre></div>

<p>function n√†y c√≥ th·ªÉ thi·∫øu <code>query</code>, thi·∫øu <code>file_path</code>, v·∫≠y vi·∫øt:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_config</span><span class="p">(</span><span class="n">argv</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Didn&#39;t get a query string&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Didn&#39;t get a file path&quot;</span><span class="p">)</span>
</code></pre></div>

<p>c√°c exception n√†y ch·ª©a n·ªôi dung m√† ng∆∞·ªùi d√πng c√≥ th·ªÉ hi·ªÉu ƒë∆∞·ª£c.</p>
<p>Ch·∫°y th·ª≠ v·ªõi 3 tr∆∞·ªùng h·ª£p l·ªói:</p>
<div class="highlight"><pre><span></span><code>$ python3 grep.py
Problem parsing arguments: Didn<span class="s1">&#39;t get a query string</span>

<span class="s1">$ python3 grep.py root</span>
<span class="s1">Problem parsing arguments: Didn&#39;</span>t get a file path

$ python3 grep.py root /etc/passssss
Application error: <span class="o">[</span>Errno <span class="m">2</span><span class="o">]</span> No such file or directory: <span class="s1">&#39;/etc/passssss&#39;</span>
</code></pre></div>

<p>T·ªõi ƒë√¢y, ch∆∞∆°ng 12 c·ªßa <strong>The book</strong> k·∫øt th√∫c.</p>
<h3>Bonus: x·ª≠ l√Ω file k√≠ch th∆∞·ªõc l·ªõn t√πy √Ω</h3>
<p>thay</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">search</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div>

<p>Th√†nh</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">search</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div>

<p>s·ª≠ d·ª•ng <code>f</code> nh∆∞ 1 iterable, m·ªói l·∫ßn l·∫•y 1 d√≤ng ra, trong search, thay:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
</code></pre></div>

<p>Th√†nh:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Function <code>search</code> thay v√¨ tr·∫£ v·ªÅ 1 list s·∫Ω yield t·ª´ng d√≤ng (generator).</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">line</span>
</code></pre></div>

<h4>So s√°nh code Rust v√† Python</h4>
<p>Phi√™n b·∫£n code cu·ªëi c√πng s·∫Ω kh√°c m·ªôt ch√∫t so v·ªõi n·ªôi dung vi·∫øt trong b√†i, nh·∫±m l√†m gi·ªëng phi√™n b·∫£n Rust nh·∫•t: v√≠ d·ª• ph·∫ßn unittest s·∫Ω ch·ªâ vi·∫øt 2 unittest nh∆∞ b·∫£n Rust, unittest b√™n tr√™n b·ªã x√≥a ƒëi ƒë·ªÉ so s√°nh cho c√¥ng b·∫±ng.</p>
<p>Code Python ng·∫Øn h∆°n Rust m·ªôt ch√∫t:</p>
<div class="highlight"><pre><span></span><code>$ wc -l grep.py test_grep.py lib.py
  <span class="m">18</span> grep.py
  <span class="m">25</span> test_grep.py
  <span class="m">52</span> lib.py
  <span class="m">95</span> total

$ wc -l src/main.rs src/lib.rs
  <span class="m">16</span> src/main.rs
 <span class="m">106</span> src/lib.rs   <span class="c1"># rust vi·∫øt test v√†o lu√¥n file code</span>
 <span class="m">122</span> total
</code></pre></div>

<p>Xem code:</p>
<ul>
<li><a href="http://pp.pymi.vn/refactor/grep.py">grep.py</a> - online <a href="https://glot.io/snippets/gky3ldwlxs">https://glot.io/snippets/gky3ldwlxs</a></li>
<li><a href="http://pp.pymi.vn/refactor/lib.py">lib.py</a> - online <a href="https://glot.io/snippets/gky3ldwlxs">https://glot.io/snippets/gky3ldwlxs</a></li>
<li><a href="http://pp.pymi.vn/refactor/main.rs">main.rs</a> - online <a href="https://gist.github.com/rust-play/5689af5322e9e26eb95458a159289f43">https://gist.github.com/rust-play/5689af5322e9e26eb95458a159289f43</a></li>
<li><a href="{stataic}/refactor/lib.rs">lib.rs</a> - online <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=0f6695e6359b96aae6ca976cc23b5c07">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=0f6695e6359b96aae6ca976cc23b5c07</a></li>
</ul>
<h4>B√†i h·ªçc</h4>
<ul>
<li>function <code>main</code> ch·ªâ n√™n parse config v√† x·ª≠ l√Ω exception</li>
<li>t√°ch ri√™ng logic ch∆∞∆°ng tr√¨nh ra th√†nh (c√°c) file ri√™ng, ch·ª©a c√°c function con cho d·ªÖ test</li>
<li>vi·∫øt unittest</li>
<li>t·∫°o abstraction khi c·∫ßn thi·∫øt (class), gi√∫p chia r√µ vai tr√≤ c·ªßa c√°c bi·∫øn kh√°c nhau</li>
<li>exception c·∫ßn ch·ª©a th√¥ng tin c√≥ √≠ch cho ng∆∞·ªùi d√πng (thay v√¨ ch·ªâ developer m·ªõi hi·ªÉu ƒë∆∞·ª£c)</li>
<li>m·ªçi th·ª© ƒë·ªÅu l√† t∆∞∆°ng ƒë·ªëi</li>
</ul>
<h3>K·∫øt lu·∫≠n</h3>
<p>Refactoring ƒë·ªÉ n√¢ng cao ch·∫•t l∆∞·ª£ng (Maintainability, Extensibility, Performance) c·ªßa code, kh√¥ng ph·∫£i ƒë·ªÉ l√†m ng·∫Øn.</p>
<h3>Tham kh·∫£o</h3>
<ul>
<li><a href="https://martinfowler.com/books/refactoring.html">https://martinfowler.com/books/refactoring.html</a></li>
<li><a href="https://doc.rust-lang.org/book/ch12-03-improving-error-handling-and-modularity.html">https://doc.rust-lang.org/book/ch12-03-improving-error-handling-and-modularity.html</a></li>
<li><a href="https://martinfowler.com/books/refactoring.html">https://martinfowler.com/books/refactoring.html</a></li>
<li><a href="https://martinfowler.com/bliki/FlagArgument.html">https://martinfowler.com/bliki/FlagArgument.html</a></li>
<li><a href="http://www.informit.com/articles/article.aspx?p=1392524">http://www.informit.com/articles/article.aspx?p=1392524</a></li>
</ul>
<p>H·∫øt!</p>
<p>HVN at <a href="http://pymi.vn">http://pymi.vn</a> and <a href="https://www.familug.org">https://www.familug.org</a>.</p>
<ul>
<li><a href="https://www.familug.org/p/ung-ho.html">·ª¶ng h·ªô t√°c gi·∫£ üç∫</a></li>
</ul>
  </div>
  <!-- /.entry-content -->
</section>
<section class="container">
  <div class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'pymier';
      var disqus_identifier = 'article/refactor/';
      var disqus_url = 'http://pp.pymi.vn/article/refactor/';
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//pymier.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the comments.</noscript>
  </div>
</section>

    <section class="container footer">
      <footer>
        <address>
        Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
        which takes great advantage of <a href="http://python.org">Python</a>.
        </address>
        <address>
          H·ªçc l·∫≠p tr√¨nh Python t·∫°i <a href="https://pymi.vn/">Pymi.vn</a>
        </address>
      </footer>
    </section>
  </main>

<script type="text/javascript">
var images = document.getElementsByTagName("img");
var i;

for(i = 0; i < images.length; i++) {
  images[i].className += " centered";
}
</script>
</body>

</html>